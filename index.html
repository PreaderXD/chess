<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Enhanced Chess Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: #f0f0f0;
        }

        #chessboard {
            width: 480px;
            height: 480px;
            display: flex;
            flex-wrap: wrap;
            margin: 20px auto;
            border: 4px solid #333;
        }

        .square {
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 36px;
            cursor: pointer;
            box-sizing: border-box;
            user-select: none;
        }

        .light {
            background-color: #f0d9b5;
        }

        .dark {
            background-color: #b58863;
        }

        .selected {
            outline: 3px solid red;
        }

        .highlight {
            background-color: rgba(255, 255, 0, 0.5);
        }

        .undo-btn, .game-history-btn {
            margin: 20px;
            padding: 10px 20px;
            background-color: #2f80ed;
            color: white;
            border: none;
            font-size: 16px;
            cursor: pointer;
        }

        .undo-btn:hover, .game-history-btn:hover {
            background-color: #1f69b0;
        }

        #game-history {
            margin-top: 20px;
            list-style-type: none;
            padding: 0;
        }

        #game-history li {
            padding: 5px;
            background-color: #fff;
            margin: 5px 0;
            border-radius: 5px;
        }

    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
    <h1>Enhanced Chess Game</h1>
    <button class="undo-btn">Undo Last Move</button>
    <button class="game-history-btn">Game History</button>
    <div id="chessboard"></div>
    <ul id="game-history"></ul>

    <script>
        $(document).ready(function() {
            const board = $('#chessboard');
            const gameHistory = $('#game-history');
            let selected = null;
            let currentPlayer = 'white';
            let promotionPending = null;
            let moveHistory = []; // Stores the history of moves (board states)
            let initialPosition = [
                ['♜', '♞', '♝', '♛', '♚', '♝', '♞', '♜'],
                ['♟', '♟', '♟', '♟', '♟', '♟', '♟', '♟'],
                ['', '', '', '', '', '', '', ''],
                ['', '', '', '', '', '', '', ''],
                ['', '', '', '', '', '', '', ''],
                ['', '', '', '', '', '', '', ''],
                ['♙', '♙', '♙', '♙', '♙', '♙', '♙', '♙'],
                ['♖', '♘', '♗', '♕', '♔', '♗', '♘', '♖'],
            ];

            // Function to render the chessboard
            function renderBoard() {
                board.empty();
                for (let row = 0; row < 8; row++) {
                    for (let col = 0; col < 8; col++) {
                        const piece = initialPosition[row][col];
                        const color = (row + col) % 2 === 0 ? 'light' : 'dark';
                        const square = $('<div>')
                            .addClass('square')
                            .addClass(color)
                            .attr('data-row', row)
                            .attr('data-col', col)
                            .html(piece)
                            .attr('draggable', true);

                        square.on('dragstart', handleDragStart);
                        square.on('dragover', handleDragOver);
                        square.on('drop', handleDrop);

                        board.append(square);
                    }
                }
            }

            // Save the current board state in the history
            function saveMoveState() {
                const boardState = initialPosition.map(row => row.slice());
                moveHistory.push(boardState);
                renderHistory();
            }

            // Undo the last move
            function undoMove() {
                if (moveHistory.length > 0) {
                    initialPosition = moveHistory.pop();
                    renderBoard();
                    currentPlayer = currentPlayer === 'white' ? 'black' : 'white'; // Revert the turn
                }
            }

            // Render the move history
            function renderHistory() {
                gameHistory.empty();
                moveHistory.forEach((state, index) => {
                    const move = `Move ${index + 1}: ${JSON.stringify(state)}`;
                    gameHistory.append(`<li>${move}</li>`);
                });
            }

            // Highlight legal moves for the selected piece
            function highlightLegalMoves(row, col, piece) {
                const legalMoves = getLegalMoves(row, col, piece);
                $('.square').removeClass('highlight');
                legalMoves.forEach(move => {
                    const targetSquare = $(`.square[data-row="${move.row}"][data-col="${move.col}"]`);
                    targetSquare.addClass('highlight');
                });
            }

            // Get legal moves for a piece at a given position
            function getLegalMoves(row, col, piece) {
                let legalMoves = [];
                for (let r = 0; r < 8; r++) {
                    for (let c = 0; c < 8; c++) {
                        if (isValidMove(row, col, r, c, piece)) {
                            legalMoves.push({ row: r, col: c });
                        }
                    }
                }
                return legalMoves;
            }

            // Check if a move is valid (simplified version for demo)
            function isValidMove(fromRow, fromCol, toRow, toCol, piece) {
                return fromRow !== toRow || fromCol !== toCol; // A move is valid if it's not the same square
            }

            // Handle drag start event
            function handleDragStart(event) {
                const piece = $(this).html();
                event.originalEvent.dataTransfer.setData('piece', piece);
                selected = { row: $(this).data('row'), col: $(this).data('col') };
                $(this).addClass('selected');
            }

            // Handle drag over event
            function handleDragOver(event) {
                event.preventDefault(); // Allow dropping
            }

            // Handle drop event
            function handleDrop(event) {
                const piece = event.originalEvent.dataTransfer.getData('piece');
                const row = $(this).data('row');
                const col = $(this).data('col');

                if (isValidMove(selected.row, selected.col, row, col, piece)) {
                    initialPosition[row][col] = piece;
                    initialPosition[selected.row][selected.col] = ''; // Remove the piece from the original square
                    saveMoveState();
                    renderBoard();
                    currentPlayer = currentPlayer === 'white' ? 'black' : 'white'; // Switch turn
                    renderHistory(); // Update the game history
                }

                $(this).removeClass('highlight'); // Remove highlight
            }

            // Event listener for undo button
            $('.undo-btn').on('click', function() {
                undoMove();
            });

            // Event listener for game history button
            $('.game-history-btn').on('click', function() {
                $('#game-history').toggle(); // Show or hide the game history
            });

            renderBoard();
        });
    </script>
</body>

</html>
